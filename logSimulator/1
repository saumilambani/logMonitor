'''
This file is used to generate w3 format logs 
'''
import argparse
from time import sleep
import logging
import sys
import random
import ConfigParser
import entry
import time

CONFIG_FILE = "console.cfg"
ACCESS_LOG_FILE = "data/accessLog.txt"

def addEntry(logFile):
  accessEntry = str(entry.Entry())
  logFile.write(accessEntry)
  logFile.flush()

  # Change to print (accessEntry,end="") for python3 
  print (accessEntry),

def logSimulator():
  parser=argparse.ArgumentParser()
  parser.add_argument("--nbLine", help="Number of lines to be generated")
  args=parser.parse_args()

  config = ConfigParser.RawConfigParser()
  config.read(CONFIG_FILE)
  logInterval = config.getfloat('Simulator', 'logInterval')

  with open(ACCESS_LOG_FILE,'w') as logFile:
    if args.nbLine is None:
      while True:
        addEntry(logFile)
        sleep(genLogInterval()+random.random())
    else:
      for _ in range(int(args.nbLine)):
        addEntry(logFile)
        sleep(genLogInterval()+random.random())
  return 0

def genLogInterval():
  # Will vary the value from 0 to 0.5 
  intValue = (time.time())%20/40.0 
  print "Time is: " + str(intValue)
  return 0.3


if __name__ == '__main__':
  logSimulator() 

